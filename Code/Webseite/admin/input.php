<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../css/main.css" rel="stylesheet" type="text/css" media="all">
    <title>admin</title>
</head>
<body>
    <nav class="navbar">
        <ul class="navbar-nav">
            <li class="logo">
                <img src="../Bilder/est_logo_270x150.png" alt="Logo">
            </li>
            <li class="nav-item">
                <a href="../index.php" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M25.45 19.35V5.45h17.1v13.9Zm-20 6.4V5.45h17.1v20.3Zm20 16.75V22.25h17.1V42.5Zm-20 0V28.6h17.1v13.9ZM8.9 22.3h10.25V8.85H8.9Zm19.95 16.8h10.3V25.65h-10.3Zm0-23.15h10.3v-7.1h-10.3ZM8.9 39.1h10.25V32H8.9Zm10.25-16.8Zm9.7-6.35Zm0 9.7ZM19.15 32Z"/></svg>
                    <span class="link-text">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="../zaehler.php" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M19.95 42 22 27.9h-7.3q-.55 0-.8-.5t0-.95L26.15 6h2.05l-2.05 14.05h7.2q.55 0 .825.5.275.5.025.95L22 42Z"/></svg>
                    <span class="link-text">Altbau</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M3.7 36.25v-3.4q1.95 0 3.125-1.175T10.3 30.5q2.3 0 3.575 1.375Q15.15 33.25 17.1 33.25q2 0 3.3-1.375Q21.7 30.5 24 30.5t3.575 1.375q1.275 1.375 3.275 1.375t3.275-1.375Q35.4 30.5 37.7 30.5q2.3 0 3.475 1.175Q42.35 32.85 44.3 32.85v3.4q-2.4 0-3.55-1.15t-3.05-1.15q-1.95 0-3.25 1.35t-3.6 1.35q-2.3 0-3.6-1.35-1.3-1.35-3.25-1.35-1.9 0-3.25 1.35t-3.65 1.35q-2.3 0-3.575-1.35-1.275-1.35-3.225-1.35-1.9 0-3.05 1.15T3.7 36.25Zm0-8.4v-3.4q1.95 0 3.125-1.175T10.3 22.1q2.3 0 3.575 1.375Q15.15 24.85 17.1 24.85q2 0 3.3-1.375Q21.7 22.1 24 22.1t3.575 1.375q1.275 1.375 3.275 1.375t3.275-1.375Q35.4 22.1 37.7 22.1q2.3 0 3.475 1.175Q42.35 24.45 44.3 24.45v3.4q-2.4 0-3.55-1.175T37.7 25.5q-1.95 0-3.25 1.375t-3.6 1.375q-2.3 0-3.6-1.375Q25.95 25.5 24 25.5q-1.9 0-3.25 1.375T17.1 28.25q-2.25 0-3.55-1.375-1.3-1.375-3.25-1.375-1.9 0-3.05 1.175T3.7 27.85Zm0-8.4V16q1.95 0 3.125-1.15T10.3 13.7q2.3 0 3.575 1.35Q15.15 16.4 17.1 16.4q2 0 3.3-1.35 1.3-1.35 3.6-1.35t3.575 1.35q1.275 1.35 3.275 1.35t3.275-1.35Q35.4 13.7 37.7 13.7q2.3 0 3.475 1.15Q42.35 16 44.3 16v3.45q-2.4 0-3.55-1.175T37.7 17.1q-1.95 0-3.25 1.375t-3.6 1.375q-2.3 0-3.6-1.375Q25.95 17.1 24 17.1q-1.9 0-3.25 1.375T17.1 19.85q-2.25 0-3.55-1.375-1.3-1.375-3.25-1.375-1.9 0-3.05 1.175T3.7 19.45Z"/></svg>
                    <span class="link-text">Wasser</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M11.25 28q0 2.95 1.3 5.575t3.65 4.375q-.2-.55-.3-1.125-.1-.575-.1-1.175.05-1.5.675-2.85t1.725-2.45L24 24.6l5.8 5.75q1.15 1.1 1.75 2.45.6 1.35.65 2.85 0 .6-.1 1.175-.1.575-.3 1.125 2.35-1.75 3.65-4.375 1.3-2.625 1.3-5.575 0-2.6-1.1-5.1-1.1-2.5-3.15-4.6-1.05.7-2.2 1.125-1.15.425-2.25.425-3 0-5.025-2-2.025-2-2.175-5.1v-1q-2.2 1.6-3.975 3.55-1.775 1.95-3.025 4.075T11.925 23.7q-.675 2.2-.675 4.3ZM24 29.4l-3.4 3.35q-.7.7-1.05 1.525-.35.825-.35 1.775 0 1.95 1.4 3.325Q22 40.75 24 40.75t3.4-1.375Q28.8 38 28.8 36.05q0-.95-.35-1.775t-1-1.525Zm.2-23.7v6.9q0 1.6 1.1 2.7t2.75 1.1q.85 0 1.6-.35.75-.35 1.3-1.05l1-1.25q3.8 2.2 6.025 6Q40.2 23.55 40.2 28q0 6.75-4.725 11.475T24 44.2q-6.8 0-11.5-4.7T7.8 28q0-6.45 4.4-12.475Q16.6 9.5 24.2 5.7Z"/></svg>
                    <span class="link-text">Gas</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./index.php" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M24.4 42.3v-3.4H39V9.1H24.4V5.7H39q1.4 0 2.425 1t1.025 2.4v29.8q0 1.35-1.025 2.375T39 42.3Zm-4.1-9.1-2.45-2.45 5.05-5.05H5.55v-3.4H22.8l-5.05-5.05 2.45-2.45 9.2 9.25Z"/></svg>
                    <span class="link-text">Anmelden</span>
                </a>
            </li>
        </ul>
    </nav>
    <main>
        <?php
        try
        {
          // Verbindung zur Datenbank aufbauen
          $mysqli = new mysqli("localhost", "energieAdmin", "", "Energie");
        }
        catch (Exception $e)
        {
          echo "Failed to connect to MySQL: " . $e->getMessage();
          exit;
        }
        if (isset($_GET["Werte"])) {
            if ($_GET["delWert"]>0) {

                try{
                    $stmt = $mysqli->prepare("DELETE FROM Aktuell where WertNr = ?");
                    $stmt->bind_param("i", $_GET["delWert"]);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }

                try{
                    $stmt = $mysqli->prepare("DELETE FROM Werte where WertNr = ?");
                    $stmt->bind_param("i", $_GET["delWert"]);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }

                echo "Erfolgreich Gelöscht";
            }
            else
            {
                try{
                    $stmt = $mysqli->prepare("INSERT INTO Werte(WertNr, Adresse, Beschreibung, Einheit, Bcd, StartFeld, EndFeld, TeleNr, Multiplikator, Speicherung) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
                    $stmt->bind_param("iissiiiidi", $_GET["WWertNr"], 
                    $_GET["WAdresse"],
                    $_GET["WBeschreibung"],
                    $_GET["WEinheit"],
                    $_GET["WBcd"],
                    $_GET["WStartFeld"],
                    $_GET["WEndFeld"],
                    $_GET["WTeleNr"],
                    $_GET["WMultiplikator"],
                    $_GET["WSpeicherung"]);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }

                try{
                    $stmt = $mysqli->prepare("INSERT INTO Aktuell(WertNr, Wert) values (?, 0)");
                    $stmt->bind_param("i", $_GET["WWertNr"]);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }
                echo "Erolgreich eingefügt";
            }
        }
        else {
            if ($_GET["delAdress"]>0) {
                try{
                    $stmt = $mysqli->prepare("DELETE FROM Zaehler where Adresse = ?");
                    $stmt->bind_param("i", $_GET["delAdress"]);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }
                echo "Erfolgreich Gelöscht";
            }
    
            else {
                $adresse = $_GET["Adresse"];
                $beschreibung = $_GET["Beschreibung"];
                $medium = $_GET["Medium"];
        
                try{
                    $stmt = $mysqli->prepare("INSERT INTO Zaehler(Adresse, Beschreibung) values (?, ?)");
                    $stmt->bind_param("iss", $adresse, $beschreibung);
                    $stmt->execute();
                }
                catch (Exception $e)
                {
                  die("Fehler bei Datenbankzugriff: " . $e->getMessage());
                }
                echo "Erolgreich eingefügt";
            }
        }

        $mysqli->close();
        
        ?>
    </main>
</body>
</html>
